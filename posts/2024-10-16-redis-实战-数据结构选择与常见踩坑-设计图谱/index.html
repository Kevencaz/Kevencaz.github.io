<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Technology Stack"><title>Redis å®æˆ˜ï¼šæ•°æ®ç»“æ„é€‰æ‹©ä¸å¸¸è§è¸©å‘ï½œè®¾è®¡å›¾è°± | Mystwood</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" href="/styles/global.css"><link rel="stylesheet" href="/_astro/Gitalk.B4AMVcrv.css">
<style>#gitalk-container{margin-top:60px;padding:20px;background:#0a0e1799;border:1px solid rgba(0,240,255,.2);border-radius:8px}.gt-container{color:#e0e0e0!important}.gt-container .gt-header-textarea{background:#0a0e17cc!important;border:1px solid rgba(0,240,255,.3)!important;color:#e0e0e0!important}.gt-container .gt-header-textarea:focus{border-color:var(--primary)!important;box-shadow:0 0 10px #00f0ff4d!important}.gt-container .gt-btn{background:linear-gradient(135deg,var(--primary),var(--primary-dark))!important;border:none!important;color:#fff!important;transition:all .3s ease!important}.gt-container .gt-btn:hover{box-shadow:0 0 15px #00f0ff80!important;transform:translateY(-2px)}.gt-container .gt-btn-preview{background:#b44aff33!important;border:1px solid rgba(180,74,255,.5)!important;color:var(--secondary)!important}.gt-container .gt-comment-content{background:#0a0e1799!important;border:1px solid rgba(0,240,255,.1)!important;color:#e0e0e0!important}.gt-container .gt-comment-content:hover{box-shadow:0 0 10px #00f0ff33!important}.gt-container a{color:var(--primary)!important}.gt-container a:hover{color:var(--secondary)!important}.gt-container .gt-comment-username{color:var(--primary)!important;font-weight:600!important}.gt-container .gt-comment-date{color:#888!important}.gt-container .gt-svg svg{fill:var(--primary)!important}.gt-container .gt-comment-admin .gt-comment-content{border-left:3px solid var(--primary)!important}
</style></head> <body> <div class="reading-progress" id="reading-progress"></div> <script type="module">const n=document.getElementById("reading-progress");n&&window.addEventListener("scroll",()=>{const e=document.documentElement.scrollHeight-window.innerHeight,t=e>0?window.scrollY/e*100:0;n.style.width=`${t}%`});</script> <div class="layout"> <aside class="sidebar"> <div class="sidebar-inner"> <div class="site-author"> <a href="/"> <img class="avatar" src="/images/header.png" alt="Keven" width="96" height="96"> </a> <h2 class="author-name">Keven</h2> <p class="site-subtitle" id="typing-subtitle"></p> </div> <nav class="site-nav"> <a href="/" class="nav-item"> <span class="nav-icon">ğŸ </span> <span>é¦–é¡µ</span> </a><a href="/archives/" class="nav-item"> <span class="nav-icon">ğŸ“¦</span> <span>å½’æ¡£</span> </a><a href="/tags/" class="nav-item"> <span class="nav-icon">ğŸ·ï¸</span> <span>æ ‡ç­¾</span> </a><a href="/categories/" class="nav-item"> <span class="nav-icon">ğŸ“‚</span> <span>åˆ†ç±»</span> </a><a href="/games/" class="nav-item"> <span class="nav-icon">ğŸ®</span> <span>å°æ¸¸æˆ</span> </a> </nav> <div class="sidebar-footer"> <a href="https://github.com/Kevencaz" target="_blank" rel="noopener" class="github-link">
GitHub â†—
</a> </div> </div> </aside> <div class="main-wrapper"> <main class="main-content">  <article class="post-detail"> <header class="post-header"> <h1 class="post-title" style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;"> Redis å®æˆ˜ï¼šæ•°æ®ç»“æ„é€‰æ‹©ä¸å¸¸è§è¸©å‘ï½œè®¾è®¡å›¾è°± </h1> <div class="post-meta"> <time datetime="2024-10-16T18:02:12.000Z">2024/10/16</time> <span class="post-tags"> <a href="/tags/Redis/" class="tag">#Redis</a><a href="/tags/ç¼“å­˜/" class="tag">#ç¼“å­˜</a> </span> </div> </header> <div class="post-body"> <blockquote>
<p>é€‰å¯¹æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ä¸€åŠæ€§èƒ½ã€‚</p>
</blockquote>
<!-- more -->
<h2 id="ä¸ºä»€ä¹ˆè¦å…³æ³¨è¿™ä¸ªè¯é¢˜">ä¸ºä»€ä¹ˆè¦å…³æ³¨è¿™ä¸ªè¯é¢˜</h2>
<p>è¿™ç¯‡æ–‡ç« é¢å‘å¤šç¯å¢ƒäº¤ä»˜å›¢é˜Ÿï¼Œä»åä½œè§†è§’æ·±å…¥æ‹†è§£Redis å®æˆ˜ã€‚å½“å‰å®šä½ä¸ºã€Œæ·±æŒ–ã€é˜¶æ®µï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯è§„æ¨¡åŒ–æ¼”è¿›ä¸æˆæœ¬ä¼˜åŒ–ã€‚æˆ‘ä»¬ä¼šä»å®é™…åœºæ™¯å‡ºå‘ï¼Œç»“åˆå…·ä½“ä»£ç ç¤ºä¾‹ï¼ŒæŠŠå…³é”®çŸ¥è¯†ç‚¹æ‹†è§£ä¸ºå¯è½åœ°çš„è¡ŒåŠ¨æ­¥éª¤ã€‚è¡¡é‡æ ‡å‡†ï¼šäº¤ä»˜å‘¨æœŸ/å›æ»šæ¬¡æ•°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚å¦‚æœç”¨ String ç±»å‹ï¼Œæ¯æ¬¡æ›´æ–°ä¸€ä¸ªå­—æ®µéƒ½è¦åºåˆ—åŒ–/ååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ã€‚ç”¨ Hash ç±»å‹ï¼Œå¯ä»¥å•ç‹¬è¯»å†™æŸä¸ªå­—æ®µï¼ˆHGET user:42 nameï¼‰ï¼Œæ—¢èŠ‚çœå¸¦å®½åˆå‡å°‘åºåˆ—åŒ–å¼€é”€ã€‚å†æ¯”å¦‚æ’è¡Œæ¦œåŠŸèƒ½ï¼Œç”¨ Sorted Set ä¸€è¡Œå‘½ä»¤ï¼ˆZADD + ZREVRANGEï¼‰å°±èƒ½å®ç°ï¼Œå¦‚æœç”¨ String å­˜å‚¨å†åœ¨åº”ç”¨å±‚æ’åºï¼Œå¤æ‚åº¦å’Œæ€§èƒ½éƒ½å·®å¾ˆå¤šã€‚</p>
<h2 id="èƒŒæ™¯ä¸é—®é¢˜">èƒŒæ™¯ä¸é—®é¢˜</h2>
<p>Redis ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œä¸ä»…å› ä¸ºå®ƒå¿«ï¼ˆå†…å­˜æ“ä½œ + å•çº¿ç¨‹é¿å…é”ç«äº‰ï¼‰ï¼Œæ›´å› ä¸ºå®ƒæä¾›äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼šStringã€Hashã€Listã€Setã€Sorted Setã€HyperLogLogã€Bitmap ç­‰ã€‚ä¸åŒçš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œæ€§èƒ½å’Œå†…å­˜æ•ˆç‡å¯ä»¥å·®å‡ å€ç”šè‡³å‡ åå€ã€‚å¾ˆå¤šäººæŠŠ Redis å½“æˆâ€å¿«é€Ÿçš„ Key-Value å­˜å‚¨â€ï¼Œåªç”¨ String ç±»å‹ï¼Œè¿™æ˜¯å¯¹ Redis èƒ½åŠ›çš„å·¨å¤§æµªè´¹ã€‚</p>
<p>åœ¨ã€Œä¸šåŠ¡å¢é•¿å¸¦æ¥çš„å®¹é‡å‹åŠ›ã€è¿™ä¸ªé˜¶æ®µï¼Œåä½œé—®é¢˜å°¤ä¸ºçªå‡ºã€‚è§„èŒƒç¼ºå¤±é€ æˆè¿”å·¥æ˜¯æœ€å®¹æ˜“è¸©çš„å‘ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»ºç«‹æ­£ç¡®çš„åº¦é‡ä½“ç³»ï¼Œå†é€æ­¥ä¼˜åŒ–ã€‚</p>
<h2 id="æ–¹æ³•è®ºä¸å®è·µè·¯å¾„">æ–¹æ³•è®ºä¸å®è·µè·¯å¾„</h2>
<p>æ•°æ®ç»“æ„é€‰æ‹©æŒ‡å—ï¼š</p>
<p>Stringï¼šç®€å•çš„é”®å€¼å¯¹ã€è®¡æ•°å™¨ï¼ˆINCRï¼‰ã€åˆ†å¸ƒå¼é”ï¼ˆSET NX EXï¼‰ã€ç¼“å­˜åºåˆ—åŒ–å¯¹è±¡ã€‚
Hashï¼šå¯¹è±¡å±æ€§å­˜å‚¨ï¼ˆç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…ï¼‰ï¼Œæ”¯æŒå•å­—æ®µè¯»å†™ã€‚
Listï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆLPUSH + BRPOPï¼‰ã€æœ€æ–°åŠ¨æ€åˆ—è¡¨ï¼ˆLPUSH + LTRIM ä¿æŒå›ºå®šé•¿åº¦ï¼‰ã€‚
Setï¼šæ ‡ç­¾ç³»ç»Ÿã€å…±åŒå¥½å‹ï¼ˆSINTERï¼‰ã€å»é‡è®¡æ•°ã€‚
Sorted Setï¼šæ’è¡Œæ¦œã€å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆç”¨ score å­˜æ—¶é—´æˆ³ï¼‰ã€èŒƒå›´æŸ¥è¯¢ã€‚
HyperLogLogï¼šå¤§è§„æ¨¡å»é‡è®¡æ•°ï¼ˆUV ç»Ÿè®¡ï¼‰ï¼Œå†…å­˜å›ºå®š 12KBï¼Œè¯¯å·®çº¦ 0.81%ã€‚
Bitmapï¼šç”¨æˆ·ç­¾åˆ°ã€ç‰¹æ€§å¼€å…³ã€å¸ƒéš†è¿‡æ»¤å™¨çš„åº•å±‚å®ç°ã€‚</p>
<p>Key å‘½åè§„èŒƒå»ºè®®ä½¿ç”¨å†’å·åˆ†éš”çš„å±‚çº§ç»“æ„ï¼šä¸šåŠ¡:å¯¹è±¡ç±»å‹:ID:å­—æ®µï¼Œå¦‚ order:detail:12345 æˆ– user:session:abc123ã€‚ç»Ÿä¸€çš„å‘½åè®©è¿ç»´å’Œæ’æŸ¥é—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½ã€‚</p>
<h2 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥å‚è€ƒçš„æ·±æŒ–çº§åˆ«ç¤ºä¾‹ï¼š</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#7F848E;font-style:italic"># Hash å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆæ”¯æŒå•å­—æ®µæ“ä½œï¼‰</span></span>
<span class="line"><span style="color:#61AFEF">HSET</span><span style="color:#98C379"> user:42</span><span style="color:#98C379"> name</span><span style="color:#98C379"> "keven"</span><span style="color:#98C379"> email</span><span style="color:#98C379"> "k@example.com"</span><span style="color:#98C379"> plan</span><span style="color:#98C379"> "pro"</span></span>
<span class="line"><span style="color:#61AFEF">HGET</span><span style="color:#98C379"> user:42</span><span style="color:#98C379"> name</span><span style="color:#7F848E;font-style:italic">          # åªè¯»å– name å­—æ®µ</span></span>
<span class="line"><span style="color:#61AFEF">HINCRBY</span><span style="color:#98C379"> user:42</span><span style="color:#98C379"> login_count</span><span style="color:#D19A66"> 1</span><span style="color:#7F848E;font-style:italic">  # åŸå­é€’å¢</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># Sorted Set å®ç°æ’è¡Œæ¦œ</span></span>
<span class="line"><span style="color:#61AFEF">ZADD</span><span style="color:#98C379"> leaderboard</span><span style="color:#D19A66"> 120</span><span style="color:#98C379"> "user:42"</span><span style="color:#D19A66"> 95</span><span style="color:#98C379"> "user:13"</span><span style="color:#D19A66"> 200</span><span style="color:#98C379"> "user:7"</span></span>
<span class="line"><span style="color:#61AFEF">ZREVRANGE</span><span style="color:#98C379"> leaderboard</span><span style="color:#D19A66"> 0</span><span style="color:#D19A66"> 9</span><span style="color:#98C379"> WITHSCORES</span><span style="color:#7F848E;font-style:italic">  # Top 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># åˆ†å¸ƒå¼é”ï¼ˆåŸå­æ“ä½œï¼‰</span></span>
<span class="line"><span style="color:#61AFEF">SET</span><span style="color:#98C379"> lock:order:123</span><span style="color:#98C379"> "owner-id"</span><span style="color:#98C379"> NX</span><span style="color:#98C379"> EX</span><span style="color:#D19A66"> 30</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># ä¸šåŠ¡å¤„ç†...</span></span>
<span class="line"><span style="color:#61AFEF">DEL</span><span style="color:#98C379"> lock:order:123</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># å†…å­˜åˆ†æ</span></span>
<span class="line"><span style="color:#61AFEF">MEMORY</span><span style="color:#98C379"> USAGE</span><span style="color:#98C379"> user:42</span></span>
<span class="line"><span style="color:#61AFEF">INFO</span><span style="color:#98C379"> memory</span></span></code></pre>
<h2 id="è½åœ°å»ºè®®">è½åœ°å»ºè®®</h2>
<p>å†…å­˜ç®¡ç†æ˜¯ Redis è¿ç»´çš„é‡ç‚¹ã€‚å»ºè®®ä¸ºæ‰€æœ‰ Key è®¾ç½® TTLï¼Œé¿å…å†…å­˜æ— é™å¢é•¿ã€‚ä½¿ç”¨ MEMORY USAGE å‘½ä»¤æ£€æŸ¥å¤§ Keyï¼Œè¶…è¿‡ 10KB çš„ String æˆ–è¶…è¿‡ 5000 ä¸ªå…ƒç´ çš„é›†åˆéƒ½åº”è¯¥è€ƒè™‘æ‹†åˆ†ã€‚é…ç½® maxmemory-policy ä¸º allkeys-lru æˆ– volatile-lruï¼Œè®© Redis åœ¨å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨æ·˜æ±°ã€‚ç›‘æ§æ–¹é¢ï¼Œå…³æ³¨ used_memoryã€keyspace_hits/missesï¼ˆå‘½ä¸­ç‡ï¼‰ã€connected_clientsã€‚</p>
<h2 id="å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—">å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—</h2>
<p>æœ€å¸¸è§çš„é”™è¯¯æ˜¯å¤§ Key é—®é¢˜ï¼šä¸€ä¸ª Hash å­˜äº†å‡ åä¸‡ä¸ªå­—æ®µï¼Œåˆ é™¤æ—¶ä¼šé˜»å¡ Redis å‡ ç§’ã€‚å…¶æ¬¡æ˜¯çƒ­ Key é—®é¢˜ï¼šæŸä¸ª Key çš„ QPS ç‰¹åˆ«é«˜ï¼Œå•ä¸ª Redis èŠ‚ç‚¹æ‰›ä¸ä½ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æœ¬åœ°ç¼“å­˜ + è¯»å‰¯æœ¬åˆ†æ•£å‹åŠ›ã€‚è¿˜æœ‰ä¸€ä¸ªå®¹æ˜“å¿½ç•¥çš„é—®é¢˜æ˜¯ Key è¿‡æœŸç­–ç•¥ï¼šRedis çš„è¿‡æœŸæ˜¯æƒ°æ€§åˆ é™¤ + å®šæœŸåˆ é™¤ï¼Œå¤§é‡ Key åŒæ—¶è¿‡æœŸå¯èƒ½å¯¼è‡´ç¬é—´ CPU é£™é«˜ã€‚</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>Redis å®æˆ˜çš„æ·±æŒ–é˜¶æ®µï¼Œæ ¸å¿ƒæ˜¯è§„æ¨¡åŒ–æ¼”è¿›ä¸æˆæœ¬ä¼˜åŒ–ã€‚ä»åä½œè§’åº¦å‡ºå‘ï¼Œå…³æ³¨äº¤ä»˜å‘¨æœŸ/å›æ»šæ¬¡æ•°ï¼Œé¿å…è§„èŒƒç¼ºå¤±é€ æˆè¿”å·¥ã€‚æŠŠä¸Šé¢çš„å®è·µæ¸…å•é€é¡¹è½åœ°ï¼Œä½ ä¼šå‘ç°æ•ˆæœæ¯”æƒ³è±¡ä¸­æ¥å¾—å¿«ã€‚</p> </div> </article>  <div id="gitalk-container" data-id="2024-10-16-redis-å®æˆ˜-æ•°æ®ç»“æ„é€‰æ‹©ä¸å¸¸è§è¸©å‘-è®¾è®¡å›¾è°±" data-title="Redis å®æˆ˜ï¼šæ•°æ®ç»“æ„é€‰æ‹©ä¸å¸¸è§è¸©å‘ï½œè®¾è®¡å›¾è°±"></div> <script type="module" src="/_astro/Gitalk.astro_astro_type_script_index_0_lang.Cal0MJAU.js"></script>   <footer class="site-footer"> <div class="footer-inner"> <span>Â© 2019â€“2026 Keven</span> <span class="heart">â¤ï¸</span> <span>Powered by <a href="https://astro.build" target="_blank" rel="noopener">Astro</a></span> </div> <div class="visitor-stats"> <span id="busuanzi_container_site_pv">
ğŸ‘€ æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv">-</span> æ¬¡
</span> <span id="busuanzi_container_site_uv">
ğŸ‘¤ è®¿å®¢æ•° <span id="busuanzi_value_site_uv">-</span> äºº
</span> </div> </footer> </main> </div> </div> <button class="back-to-top" id="back-to-top" aria-label="å›åˆ°é¡¶éƒ¨" title="å›åˆ°é¡¶éƒ¨">â†‘</button> <script type="module">const o=document.getElementById("back-to-top");o&&(window.addEventListener("scroll",()=>{o.classList.toggle("visible",window.scrollY>300)}),o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}));</script> <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> <script>(function(){const typingTexts = ["Welcome to my blog ğŸš€","è®°å½•å­¦ä¹ ï¼Œåˆ†äº«æˆé•¿ âœ¨","Code Â· Think Â· Create ğŸ’¡"];

    // é¼ æ ‡ç‚¹å‡»çƒŸèŠ±ç‰¹æ•ˆ
    document.addEventListener('click', function(e) {
      const colors = ['#00f0ff','#b44aff','#ff2d95','#39ff14','#ffe600','#00f0ff'];
      for (let i = 0; i < 12; i++) {
        const dot = document.createElement('div');
        dot.style.cssText = `position:fixed;pointer-events:none;width:6px;height:6px;border-radius:50%;z-index:99999;left:${e.clientX}px;top:${e.clientY}px;background:${colors[Math.floor(Math.random()*colors.length)]}`;
        document.body.appendChild(dot);
        const angle = (Math.PI * 2 / 12) * i;
        const velocity = 60 + Math.random() * 60;
        const dx = Math.cos(angle) * velocity;
        const dy = Math.sin(angle) * velocity;
        const x = e.clientX, y = e.clientY;
        let start = null;
        function anim(ts) {
          if (!start) start = ts;
          const p = (ts - start) / 600;
          if (p >= 1) { dot.remove(); return; }
          dot.style.left = (x + dx * p) + 'px';
          dot.style.top = (y + dy * p + 40 * p * p) + 'px';
          dot.style.opacity = String(1 - p);
          dot.style.transform = `scale(${1 - p * 0.5})`;
          requestAnimationFrame(anim);
        }
        requestAnimationFrame(anim);
      }
    });
    // åŠ¨æ€æ‰“å­—å‰¯æ ‡é¢˜
    const el = document.getElementById('typing-subtitle');
    if (el) {
      const texts = typingTexts;
      let ti = 0, ci = 0, deleting = false;
      function tick() {
        const current = texts[ti];
        if (!deleting) {
          el.textContent = current.substring(0, ci + 1);
          ci++;
          if (ci >= current.length) { deleting = true; setTimeout(tick, 1800); return; }
          setTimeout(tick, 80);
        } else {
          el.textContent = current.substring(0, ci - 1);
          ci--;
          if (ci <= 0) { deleting = false; ti = (ti + 1) % texts.length; setTimeout(tick, 400); return; }
          setTimeout(tick, 40);
        }
      }
      tick();
    }
  })();</script> </body> </html>