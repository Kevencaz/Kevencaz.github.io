---
import Sidebar from '@/components/Sidebar.astro';
import Footer from '@/components/Footer.astro';
import ReadingProgress from '@/components/ReadingProgress.astro';
import BackToTop from '@/components/BackToTop.astro';
import { SITE, TYPING_TEXTS } from '@/config';

interface Props {
  title?: string;
  description?: string;
}

const { title, description } = Astro.props;
const pageTitle = title ? `${title} | ${SITE.title}` : SITE.title;
const pageDesc = description || SITE.description;
---

<!doctype html>
<html lang={SITE.lang}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={pageDesc} />
  <title>{pageTitle}</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/styles/global.css" />
</head>
<body>
  <ReadingProgress />
  <div class="layout">
    <Sidebar />
    <div class="main-wrapper">
      <main class="main-content">
        <slot />
        <Footer />
      </main>
    </div>
  </div>
  <BackToTop />
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script define:vars={{ typingTexts: TYPING_TEXTS }}>
    // 鼠标点击烟花特效
    document.addEventListener('click', function(e) {
      const colors = ['#00f0ff','#b44aff','#ff2d95','#39ff14','#ffe600','#00f0ff'];
      for (let i = 0; i < 12; i++) {
        const dot = document.createElement('div');
        dot.style.cssText = `position:fixed;pointer-events:none;width:6px;height:6px;border-radius:50%;z-index:99999;left:${e.clientX}px;top:${e.clientY}px;background:${colors[Math.floor(Math.random()*colors.length)]}`;
        document.body.appendChild(dot);
        const angle = (Math.PI * 2 / 12) * i;
        const velocity = 60 + Math.random() * 60;
        const dx = Math.cos(angle) * velocity;
        const dy = Math.sin(angle) * velocity;
        const x = e.clientX, y = e.clientY;
        let start = null;
        function anim(ts) {
          if (!start) start = ts;
          const p = (ts - start) / 600;
          if (p >= 1) { dot.remove(); return; }
          dot.style.left = (x + dx * p) + 'px';
          dot.style.top = (y + dy * p + 40 * p * p) + 'px';
          dot.style.opacity = String(1 - p);
          dot.style.transform = `scale(${1 - p * 0.5})`;
          requestAnimationFrame(anim);
        }
        requestAnimationFrame(anim);
      }
    });
    // 动态打字副标题
    const el = document.getElementById('typing-subtitle');
    if (el) {
      const texts = typingTexts;
      let ti = 0, ci = 0, deleting = false;
      function tick() {
        const current = texts[ti];
        if (!deleting) {
          el.textContent = current.substring(0, ci + 1);
          ci++;
          if (ci >= current.length) { deleting = true; setTimeout(tick, 1800); return; }
          setTimeout(tick, 80);
        } else {
          el.textContent = current.substring(0, ci - 1);
          ci--;
          if (ci <= 0) { deleting = false; ti = (ti + 1) % texts.length; setTimeout(tick, 400); return; }
          setTimeout(tick, 40);
        }
      }
      tick();
    }
  </script>
</body>
</html>