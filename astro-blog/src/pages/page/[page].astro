---
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostCard from '@/components/PostCard.astro';
import { getCollection } from 'astro:content';
import { sortPosts } from '@/utils';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const sorted = sortPosts(allPosts);
  const PAGE_SIZE = 10;
  const totalPages = Math.ceil(sorted.length / PAGE_SIZE);
  return Array.from({ length: totalPages - 1 }, (_, i) => ({
    params: { page: String(i + 2) },
    props: {
      posts: sorted.slice((i + 1) * PAGE_SIZE, (i + 2) * PAGE_SIZE),
      currentPage: i + 2,
      totalPages,
    },
  }));
}

const { posts, currentPage, totalPages } = Astro.props;
---

<BaseLayout title={`第 ${currentPage} 页`}>
  {posts.map((post) => (
    <PostCard
      title={post.data.title}
      date={post.data.date}
      tags={post.data.tags}
      slug={post.id}
    />
  ))}

  <div class="pagination">
    {currentPage > 1 && (
      <a href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`}>← 上一页</a>
    )}
    <span class="current">{currentPage} / {totalPages}</span>
    {currentPage < totalPages && (
      <a href={`/page/${currentPage + 1}/`}>下一页 →</a>
    )}
  </div>
</BaseLayout>
