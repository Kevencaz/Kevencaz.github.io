---
title: Node.js 服务稳定性：超时、重试、熔断与降级｜性能版
date: 2019-09-26 07:52:57
tags:
- Node.js
- 后端
---

![illustration](/images/illustrations/server.svg)

> 稳定性不是零故障，而是“可恢复”。

<!-- more -->

这篇面向2-5 人小团队，从成本视角拆解Node.js 服务稳定性，目标是用更少资源支撑同样吞吐。

我们先统一指标（QPS/成本、存储成本），再把动作拆成可验证步骤。

## 背景

依赖链路越长，波动越难避免。稳定性工程就是把失败变得可控、可预测、可恢复。

在已有系统的重构期阶段，最容易忽视的是过度优化导致投入失衡，先对齐度量口径能减少返工。

## 方法拆解

- 为所有外部调用设置超时与兜底。
- 重试要有限制，避免雪崩。
- 熔断触发后主动降级，保核心路径。

## 关键指标

- 核心指标：QPS/成本、存储成本
- 目标：用更少资源支撑同样吞吐
- 验证方式：上线后 7 天回看趋势

## 示例

~~~js
const controller = new AbortController();
const timer = setTimeout(() => controller.abort(), 1500);
const res = await fetch(url, { signal: controller.signal });
clearTimeout(timer);
~~~

## 常见误区

- 超时缺失导致线程堆积
- 无限重试放大故障
- 降级逻辑与业务耦合太深
- 过度优化导致投入失衡

## 工具与资料

- 流水线：GitHub Actions
- 性能：Lighthouse/DevTools
- 质量：ESLint/单测

## Checklist

- 核心依赖有超时
- 重试次数 <= 2
- 关键接口有降级策略
- 节奏：双周迭代 + 灰度 24 小时
